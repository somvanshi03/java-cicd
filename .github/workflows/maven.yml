name: Build Selected Microservice

on:
  workflow_dispatch:
    inputs:
      service_name:
        description: 'Microservice to build (api-gateway | car-service | discovery-service)'
        required: true
        type: choice
        options:
          - api-gateway
          - car-service
          - discovery-service
      java_version:
        description: 'Java version (e.g., 17 or 21)'
        required: true
        type: choice
        options:
          - '17'
          - '21'

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      SERVICE_DIR: microservices/${{ github.event.inputs.service_name }}
      JAVA_VERSION: ${{ github.event.inputs.java_version }}

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Validate service directory exists
        run: |
          if [ ! -d "${{ env.SERVICE_DIR }}" ]; then
            echo "Service directory not found: ${{ env.SERVICE_DIR }}"
            exit 1
          fi
          echo "Building: ${{ env.SERVICE_DIR }} with Java ${{ env.JAVA_VERSION }}"

      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: ${{ env.JAVA_VERSION }}
          cache: maven # change to 'gradle' if using Gradle

      # -------- Maven build --------
      - name: Build with Maven
        working-directory: ${{ env.SERVICE_DIR }}
        run: |
          mvn -B -ntp -DskipTests=false clean verify
